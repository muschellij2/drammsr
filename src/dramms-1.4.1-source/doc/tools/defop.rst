.. raw:: html

   <!--

   ============================================================================

      DO NOT EDIT THIS FILE! It was generated using Sphinx from:

      Origin:   $URL: https://sbia-svn.uphs.upenn.edu/projects/DRAMMS/tags/dramms-1.4.1/doc/tools/defop.rst $
      Revision: $Rev: 2085 $

   ============================================================================

   -->

.. title:: Operations on Deformation


=========================
Operations on Deformation
=========================

.. _readdisplacement:

Read Displacement At A Voxel
============================

To display the displacement of the voxel (x,y,z) in the deformation ``def.nii.gz`` in the command window, and its corresponding voxel location (x', y', z'), use the following command::

    dramms-defop -c  ${x},${y},${z}  def.nii.gz

.. caution:: People often natually think that this program takes the coordinate of the SOURCE image, and output the corresponding location in the TARGET image. In practice, the reverse is true. This dramms-defop programs reads the coordinate in the TARGET image space, and displaces how it has been displaced into a corresponding voxel in the SOURCE image. This is counter-intuitive. You can think it this way: after registration, everything is in the target image space --- the source image has been deformed into target image space, so the deformation is actually defined in the target image space, and so it reads the coordinates of the target image.


	
.. _multiplytransformation:

Multiply/Divide A Transformation By A User-Input Factor
========================================================

Multiply a transformation (affine matrix or deformation) by a factor::

    dramms-defop -m ${factor}  ${in_transform}  ${out_transform}

Divide a transformation (affine matrix or deformation) by a factor::

    dramms-defop -d ${factor}  ${in_transform}  ${out_transform}
	

.. _invertdeformation:

Invert A Transformation
=======================

Invert an affine matrix: ::

    dramms-defop -i  affine.mat  inverted_affine.mat

	
Invert a deformation: ::

    dramms-defop -i  def.nii.gz  inverted_def.nii.gz

.. caution:: In general we do not recommend to directly invert a deformation using this command
             since the numerical calculations may introduce errors especially at object/image
             boundaries. Instead, we recommend to re-run the ``dramms`` registration, swapping the
             source and the target images.

.. _smoothdeformation:

Smooth A Deformation
====================

Let the output deformation replace the input deformation::

    dramms-defop -s  def.nii.gz

To keep the input deformation and generate a new smoothed deformation::
   
    dramms-defop -s  def.nii.gz  smoothed_def.nii.gz



