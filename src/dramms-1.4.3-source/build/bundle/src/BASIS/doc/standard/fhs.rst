.. raw:: html

   <!--

   ============================================================================

      DO NOT EDIT THIS FILE! It was generated using Sphinx from:

      Origin:   $URL: https://schuha@sbia-svn.uphs.upenn.edu/projects/BASIS/tags/basis-2.1.4/doc/standard/fhs.rst $
      Revision: $Rev: 2962 $

   ============================================================================

   -->

.. meta::
    :description: This article defines the filesystem hierarchy standard (FHS) of BASIS,
                  a build system and software implementation standard. The FHS defines
                  the directory structure of the project sources, the build tree, and
                  the installed software files.

=============================
Filesystem Hierarchy Standard
=============================

This document describes the filesystem hierarchy of projects following the
Build system And Software Implementation Standard (BASIS). This standard
is in particular based on the `Filesystem Hierarchy Standard of Linux`_.
The configuration of the installation is further designed such that it is
possible to account for the differences in both Unix and Windows systems as
well as the installation of multiple versions of each package. Furthermore,
the directory structure by default integrates software developed at SBIA not
only seamlessly into the target system but also the various separately managed
SBIA software packages with each other. The latter can in particular be
employed by a superproject concept based on a bundle build (also commonly
referred to as super-build).

In this document, names of CMake variables defined by the BASIS modules are
given. These are used within the CMake functions of BASIS to refer to the
particular directories of a software project. These variables should be used
either directly or indirectly where possible such that a change of the actual
directory names does not require a modification of the functions.

The BASIS Filesystem Hierarchy Standard is in particular implemented by
the :doc:`template`, which is the template for any software project
which follows BASIS. See the :doc:`/howto/create-and-modify-project`
guide for details on how to create a new project which complies with this
Filesystem Hierarchy Standard.


Legend
======

In the reminder, ``<project>`` (``<package>``) is a placeholder for the project
(or package) name in lowercase letters only and ``<Project>`` is the
case-sensitive project name.
 
Further, ``<version>`` is a placeholder for the project version string
``<major>.<minor>.<patch>``, where ``<major>`` is the major version number,
``<minor>`` the minor version number, and ``<patch>`` the patch number.

The root directory of a particular project source tree is denoted by ``<source>``,
while the root directory of the project's build or binary tree is referred to
as ``<build>``.

The root directory of a development branch such as in particular the trunk
(see :ref:`RepositoryOrganization`), is considered relative to the base URL
of the project repository and denoted by ``<tag>``, while the base URL is
referred to as ``<url>``.


.. _RepositoryOrganization:

Repository Organization
=======================

Each Subversion_ (SVN) repository contains the top-level directories ``trunk/``,
``branches/``, and ``tags/``. No other directories may be located next to these three
top-level directories.

.. The tabularcolumns directive is required to help with formatting the table properly
   in case of LaTeX (PDF) output.

.. tabularcolumns:: |p{7.25cm}|p{8.25cm}|

=======================================   ========================================================
             Repository Path                                    Description
=======================================   ========================================================
``trunk/``                                The current development version of the project.
                                          Most development is done in this master branch.
``branches/<name>/``                      Separate branches named ``<name>`` are developed in
                                          subdirectories under the branches directory. One
                                          reason for branching is, for example, to develop
                                          new features separate from the main development
                                          branch, i.e., the trunk, and merging the desired
                                          changes back to the trunk once the new feature is
                                          implemented and tested.
``branches/<project>-<major>.<minor>/``   This particular branch is used prior to releasing
                                          a new version of the project. This branch is
                                          commonly referred to as release candidate of version
                                          ``<major>.<minor>`` of the project. It is used to adjust
                                          the project files prior to tagging a particular release.
                                          For example, to set the correct version number in the
                                          project files. This branch is further be used to apply
                                          bug fixes to a previous release of this version, in
                                          which case the patch number has to be increased before
                                          tagging a new release of this software version.
                                          See the :doc:`/howto/branch-and-release` guide for
                                          further details.
``tags/<project>-<version>/``             Tagged release version of the project. The reason for
                                          including the project name in the name of the tagged
                                          branch is, that SVN uses the last URL part as name for
                                          the directory to which the URL's content is checked out
                                          or exported to if no name for this directory is specified.
=======================================   ========================================================

See the :doc:`/howto/branch-and-release` guide for details on how to create
new branches and the process of releasing a new version of a software project.

Underneath the trunk and the release branches, a version of the entire source
tree has to be found. Other branches underneath the ``branches/`` directory
may only contain a subset of the trunk such as, for example, only the source code
of the software but not the example or tests.


.. _SourceTree:

Source Tree
===========

The directory structure of the source tree, i.e., the directories and files
which are managed in a revision controlled repository, is summarized in what
follows. Other than the build and intallation tree, which are created and
populated from the source tree, is the source tree even because of this the
beating heart of a software project. The directories and files in the source
tree can be classified into the following categories: software, build
configuration, documentation, and testing. The example which is part of a
software project is considered to be part of both documentation and testing.
Furthermore, any files essential to the execution of the software are
considered to be part of the software. Examples are a pre-computed lookup
table and a medical image atlas.
 
The testing considered by BASIS can further be divided into two subcategories:
system testing and unit testing. It is important to note the difference of system
tests and unit tests. Most often, only system tests will be performed due to
the research character of the projects. These tests are usually implemented in
a scripting language such as Python, Perl, or BASH. System tests simply run
the built executables with different test input data and compare the output to
the expected results. Therefore, system tests can also be performed on a
target system using the installed software where both the software and system
tests are distributed as separate binary distribution packages. Unit tests,
on the other side, only test a single software module such as a C++ class or
Python module. The size of the  additional data required for unit tests shall
be reasonably small. Entire medical image data sets should only be required
for system tests and even then downsampled to a very low resolution for practical
reasons. The unit tests are compiled into separate executable files called test
drivers. These executable files are not essential for the functioning of the
software and are solely build for the purpose of testing.

As the testing as well as the example in the field of medical imaging often
requires a huge amount of image data, these datasets may be stored and managed
outside the source tree. Please refer to the :doc:`/howto/manage-data` guide
for details on this topic.

Below, the filesystem hierarchy of the source tree of a software project is
delineated. On the left side the names of the CMake variables defined by
BASIS are given, while on the right side the actual names of the directories
are listed::

    - PROJECT_SOURCE_DIR              - <source>/
        + PROJECT_CODE_DIR                + src/
        + PROJECT_CONFIG_DIR              + config/
        + PROJECT_DATA_DIR                + data/
        + PROJECT_DOC_DIR                 + doc/
        + PROJECT_EXAMPLE_DIR             + example/
        + PROJECT_MODULES_DIR             + modules/
        + PROJECT_TESTING_DIR             + test/

Following a description of the directories, where the names of the CMake
variables defined by BASIS are used instead of the actual directory names:


=========================   =====================================================
   Directory Variable                        Description
=========================   =====================================================
``PROJECT_SOURCE_DIR``      Root directory of source tree.
``PROJECT_CODE_DIR``        All source code files.
``PROJECT_CONFIG_DIR``      BASIS configuration files.
``PROJECT_DATA_DIR``        Software configuration files including auxiliary data
                            such as medical atlases.
``PROJECT_DOC_DIR``         Software documentation.
``PROJECT_EXAMPLE_DIR``     Example application of software.
``PROJECT_MODULES_DIR``     :doc:`Project Modules <modules>`, each residing in
                            its own subdirectory.
``PROJECT_TESTING_DIR``     Implementation of tests and test data.
=========================   =====================================================


.. _BuildTree:

Build Tree
==========

Even though CMake supports in-source tree builds, BASIS permits this and
requires that the build tree is outside the source tree. Only the files in
the source tree are considered of importance.

In the following, only the directories which do not reflect the source
tree are considered as these directories are created and populated by
CMake itself.

::

    - PROJECT_BINARY_DIR              - <build>/
        + RUNTIME_OUTPUT_DIRECTORY        + bin/
        + LIBRARY_OUTPUT_DIRECTORY        + lib/
        + ARCHIVE_OUTPUT_DIRECTORY        + lib/
        + TESTING_RUNTIME_DIR             + Testing/bin/
        + TESTING_LIBRARY_DIR             + Testing/lib/
        + TESTING_OUTPUT_DIR              + Testing/Temporary/

Following a description of the directories, where the names of the CMake
variables defined by BASIS are used instead of the actual directory names:

============================   ================================================
    Directory Variable                         Description
============================   ================================================
``RUNTIME_OUTPUT_DIRECTORY``   All executables and shared libraries (Windows).
``LIBRARY_OUTPUT_DIRECTORY``   Shared libraries (Unix).
``ARCHIVE_OUTPUT_DIRECTORY``   Static libraries and import libraries (Windows).
``TESTING_RUNTIME_DIR``        Directory of test executables.
``TESTING_LIBRARY_DIR``        Directory of libraries only used for testing.
``TESTING_OUTPUT_DIR``         Directory used for test results.
============================   ================================================


.. _InsallationTree:

Installation Tree
=================

When installing the software package by building either the install target,
extracting a binary distribution package, or running an installer of a binary
distribution package, the following directory structure is used.

In order to account for different installation schemes depending on the location
and target system on which the software is being installed, different installation
hierarchies are proposed.

The first installation scheme is referred to as the ``usr`` scheme which is in
compliance with the `Linux Filesystem Hierarchy Standard for /usr <http://www.pathname.com/fhs/pub/fhs-2.3.html#THEUSRHIERARCHY>`_::

    - CMAKE_INSTALL_PREFIX           - <prefix>/
        + INSTALL_CONFIG_DIR             + lib/cmake/<package>/
        + INSTALL_RUNTIME_DIR            + bin/
        + INSTALL_LIBEXEC_DIR            + lib/<package>/
        + INSTALL_LIBRARY_DIR            + lib/<package>/
        + INSTALL_ARCHIVE_DIR            + lib/<package>/
        + INSTALL_INCLUDE_DIR            + include/<package>/
        + INSTALL_SHARE_DIR              + share/
            + INSTALL_DATA_DIR               + <package>/data/
            + INSTALL_DOC_DIR                + doc/<package>/
            + INSTALL_EXAMPLE_DIR            + <package>/example/
            + INSTALL_MAN_DIR                + man/
            + INSTALL_INFO_DIR               + info/

Another common installation scheme, here referred to as the ``opt`` scheme and the
default used by BASIS packages, follows the
`Linux Filesystem Hierarchy Standard for Add-on Packages <http://www.pathname.com/fhs/pub/fhs-2.3.html#OPTADDONAPPLICATIONSOFTWAREPACKAGES>`_::

    - CMAKE_INSTALL_PREFIX           - <prefix>/
        + INSTALL_CONFIG_DIR             + lib/cmake/<package>/
        + INSTALL_RUNTIME_DIR            + bin/
        + INSTALL_LIBEXEC_DIR            + lib/
        + INSTALL_LIBRARY_DIR            + lib/
        + INSTALL_ARCHIVE_DIR            + lib/
        + INSTALL_INCLUDE_DIR            + include/<package>/
        + INSTALL_SHARE_DIR              + share/
            + INSTALL_DATA_DIR               + data/
            + INSTALL_DOC_DIR                + doc/
            + INSTALL_EXAMPLE_DIR            + example/
            + INSTALL_MAN_DIR                + man/
            + INSTALL_INFO_DIR               + info/

The installation scheme for Windows is::

    - CMAKE_INSTALL_PREFIX           - <prefix>/
        + INSTALL_CONFIG_DIR             + CMake/
        + INSTALL_RUNTIME_DIR            + Bin/
        + INSTALL_LIBEXEC_DIR            + Lib/
        + INSTALL_LIBRARY_DIR            + Lib/
        + INSTALL_ARCHIVE_DIR            + Lib/
        + INSTALL_INCLUDE_DIR            + Include/<package>/
        + INSTALL_SHARE_DIR              + Share/
        + INSTALL_DATA_DIR               + Data/
        + INSTALL_DOC_DIR                + Doc/
        + INSTALL_EXAMPLE_DIR            + Example/

In order to install different versions of a software, choose an installation
prefix that includes the package name and software version, for example,
``/opt/<package>-<version>`` (Unix) or ``C:/Program Files/<Package>-<version>`` (Windows).

Note that the directory for CMake package configuration files is chosen such that
CMake finds these files automatically given that the ``<prefix>`` is a system default
location or the ``INSTALL_RUNTIME_DIR`` is in the ``PATH`` environment.

.. raw:: latex

    \clearpage

Note further that the include directory by intention always ends in the package name
such that header files of a project have to be included as follows in order to avoid
conflicts with other packages which use identical names for some of their headers:

.. code-block:: c++

    #include <package/header.h>

Hence, the include directory which is added to the search path has to be set
to ``include/`` directory, but not the ``<package>`` subdirectory.

Following a description of the directories, where the names of the CMake
variables defined by BASIS are used instead of the actual directory names:

.. The tabularcolumns directive is required to help with formatting the table properly
   in case of LaTeX (PDF) output.

.. tabularcolumns:: |p{5cm}|p{10.5cm}|

=========================   ===================================================================
  Directory Variable                                 Description
=========================   ===================================================================
``CMAKE_INSTALL_PREFIX``    Common prefix (``<prefix>``) of installation directories.
                            Defaults to ``/opt/<provider>/<package>-<version>`` on Unix
                            and ``C:/Program Files/<Provider>/<Package>-<version>`` on Windows.
                            All other directories are specified relative to this prefix.
``INSTALL_CONFIG_DIR``      CMake package configuration files.
``INSTALL_RUNTIME_DIR``     Main executables and shared libraries on Windows.
``INSTALL_LIBEXEC_DIR``     Utility executables which are called by other executables only.
``INSTALL_LIBRARY_DIR``     Shared libraries on Unix and module libraries.
``INSTALL_ARCHIVE_DIR``     Static and import libraries on Windows.
``INSTALL_INCLUDE_DIR``     Public header files of libraries.
``INSTALL_DATA_DIR``        Auxiliary data files required for the execution of the software.
``INSTALL_DOC_DIR``         Documentation files including the software manual in particular.
``INSTALL_EXAMPLE_DIR``     All data required to follow example as described in manuals.
``INSTALL_MAN_DIR``         Man pages.
``INSTALL_MAN_DIR/man1/``   Man pages of the executables in ``INSTALL_RUNTIME_DIR``.
``INSTALL_MAN_DIR/man3/``   Man pages of libraries.
``INSTALL_SHARE_DIR``       Shared package files including required auxiliary data files.
=========================   ===================================================================


.. _Filesystem Hierarchy Standard of Linux: http://www.pathname.com/fhs/pub/fhs-2.3.html
.. _Subversion: http://subversion.apache.org/
